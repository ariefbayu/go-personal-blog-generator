<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Settings - Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="/admin/css/styles.css" />
</head>

<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-inner">
                <!-- User Profile / Branding -->
                <div class="sidebar-brand">
                    <div class="sidebar-avatar"
                        style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuDS7stXzuX1oFmiWsscJ6UQdJia4HQqQ1S3B16IX81s9nLilZo5vQ9BHxeqlt4NLtH425M6taGrBpy855X1FQs5QZ5zR4b614Pe9OSUye680Mn-KK-3gwBlS5hLP22HQ6eC6KTcc088z_JpDFT57Ea5gYr3cATEVUOQcbT_MnZ5Hpw3pfOj4f1-4dRnnid5Cm68psmooaxIMYwQBDjYdxFvDSZ3iloQdT-DW2iwFnxZnRrdpFz8wzZDsH9O0b5tiSgtFKN7kg8CTlsh");'>
                    </div>
                    <div class="sidebar-info">
                        <h1 class="sidebar-title">My Personal Blog</h1>
                        <p class="sidebar-subtitle">Admin Console</p>
                    </div>
                </div>
                <!-- Navigation Links -->
                <nav class="sidebar-nav">
                    <a class="nav-item" href="/admin/dashboard">
                        <span class="material-symbols-outlined">home</span>
                        <span>Dashboard</span>
                    </a>
                    <a class="nav-item" href="/admin/posts">
                        <span class="material-symbols-outlined">book_2</span>
                        <span>Blog Posts</span>
                    </a>
                    <a class="nav-item" href="/admin/portfolio">
                        <span class="material-symbols-outlined">work</span>
                        <span>Portfolios</span>
                    </a>
                    <a class="nav-item" href="/admin/pages">
                        <span class="material-symbols-outlined">code</span>
                        <span>Pages</span>
                    </a>
                    <a class="nav-item nav-item-active" href="/admin/settings">
                        <span class="material-symbols-outlined">settings</span>
                        <span>Settings</span>
                    </a>
                </nav>
            </div>
            <!-- Logout Section -->
            <div class="sidebar-footer">
            </div>
        </div>
        <!-- Main Content -->
        <div class="admin-main">
            <!-- Top Bar for Mobile -->
            <header class="admin-header-mobile">
                <h1 class="admin-header-title">Settings</h1>
                <button class="admin-header-menu-btn">
                    <span class="material-symbols-outlined">menu</span>
                </button>
            </header>
            <main class="admin-content">
                <div class="admin-container">
                    <!-- Page Heading -->
                    <div class="admin-page-header">
                        <div>
                            <h2 class="admin-page-title">Settings</h2>
                            <p class="admin-page-subtitle">Configure your site settings.</p>
                        </div>
                    </div>

                    <!-- Settings Form Container -->
                    <div class="admin-card">
                        <div class="admin-card-body">
                            <form id="settingsForm">
                                <div class="form-group">
                                    <label for="siteName" class="form-label">Site Name</label>
                                    <input type="text" id="siteName" name="siteName" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Show Menus</label>
                                    <div class="form-checkbox-group">
                                        <input type="checkbox" id="showPortfolioMenu" name="showPortfolioMenu" class="form-checkbox">
                                        <label for="showPortfolioMenu" class="form-checkbox-label">Show Portfolio Menu</label>
                                    </div>
                                    <div class="form-checkbox-group">
                                        <input type="checkbox" id="showPostsMenu" name="showPostsMenu" class="form-checkbox">
                                        <label for="showPostsMenu" class="form-checkbox-label">Show Posts Menu</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Menu Order</label>
                                    <ul id="menuOrderList" class="drag-list">
                                        <!-- Menu items will be added here -->
                                    </ul>
                                    <p class="form-hint">Drag and drop to reorder menu items</p>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">Save Settings</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();

            document.getElementById('settingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveSettings();
            });
        });

        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                const settings = await response.json();
                document.getElementById('siteName').value = settings.site_name;
                document.getElementById('showPortfolioMenu').checked = settings.show_portfolio_menu;
                document.getElementById('showPostsMenu').checked = settings.show_posts_menu;

                let menuOrder = JSON.parse(settings.menu_order || '[]');
                if (menuOrder.length === 0) {
                    menuOrder = ["posts", "portfolio", "pages"];
                }
                const list = document.getElementById('menuOrderList');
                list.innerHTML = '';
                menuOrder.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'drag-item';
                    li.draggable = true;
                    li.dataset.item = item;
                    li.innerHTML = `<span class="material-symbols-outlined">drag_indicator</span>${item}`;
                    li.addEventListener('dragstart', handleDragStart);
                    li.addEventListener('dragend', handleDragEnd);
                    li.addEventListener('dragover', handleDragOver);
                    li.addEventListener('drop', handleDrop);
                    list.appendChild(li);
                });
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        async function saveSettings() {
            const list = document.getElementById('menuOrderList');
            const items = Array.from(list.children).map(li => li.dataset.item);
            const menuOrder = JSON.stringify(items);

            const settings = {
                site_name: document.getElementById('siteName').value,
                show_portfolio_menu: document.getElementById('showPortfolioMenu').checked,
                show_posts_menu: document.getElementById('showPostsMenu').checked,
                menu_order: menuOrder
            };

            try {
                const response = await fetch('/api/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
                const result = await response.json();
                alert(result.message);
            } catch (error) {
                console.error('Error saving settings:', error);
                alert('Error saving settings');
            }
        }

        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = e.target;
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.outerHTML);
            e.target.style.opacity = '0.5';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnd(e) {
            e.target.style.opacity = '1';
        }

        function handleDrop(e) {
            e.preventDefault();
            if (draggedElement !== e.target && e.target.tagName === 'LI') {
                const list = document.getElementById('menuOrderList');
                const allItems = Array.from(list.children);
                const draggedIndex = allItems.indexOf(draggedElement);
                const targetIndex = allItems.indexOf(e.target);

                if (draggedIndex < targetIndex) {
                    list.insertBefore(draggedElement, e.target.nextSibling);
                } else {
                    list.insertBefore(draggedElement, e.target);
                }
            }
            draggedElement = null;
            return false;
        }
    </script>
</body>

</html>